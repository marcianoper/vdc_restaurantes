<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Mayoreo ‚Äî Carnicer√≠a (Pedidos por WhatsApp)</title>

  <style>
    :root{
      /* TEMA: rojo + crema (carnicer√≠a) */
      --bg:#f7efe6;          /* crema */
      --bg2:#f3e7d4;         /* crema oscuro */
      --card:#fff7ea;        /* tarjeta */
      --card2:#ffffff;
      --ink:#3b2a1f;         /* caf√© texto */
      --muted:#6e5646;       /* caf√© suave */
      --line:rgba(59,42,31,.15);

      --brand:#b91c1c;       /* rojo */
      --brand2:#991b1b;      /* rojo oscuro */
      --gold:#c98a1e;        /* acento dorado */
      --warn:#b77712;

      --shadow: 0 18px 50px rgba(32,24,16,.18);
      --r:18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--ink);
      background:
        radial-gradient(1200px 520px at 15% -10%, rgba(185,28,28,.16), transparent 55%),
        radial-gradient(900px 520px at 92% 0%, rgba(201,138,30,.14), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
    }

    /* TOP BAR */
    header{
      position: sticky; top: 0; z-index: 50;
      padding: 12px 14px;
      background: rgba(251,242,226,.88);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(59,42,31,.12);
      box-shadow: 0 10px 26px rgba(32,24,16,.14);
    }
    header .row{
      max-width:1200px;
      margin:0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex;
      flex-direction:column;
      gap:4px;
      line-height:1.05;
      min-width:0;
    }
    .brand h1{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
      font-weight:1000;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand .sub{
      font-size:12px;
      color: rgba(59,42,31,.70);
      font-weight:800;
    }

    .pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(59,42,31,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.95), rgba(255,255,255,.75));
      box-shadow: 0 14px 34px rgba(32,24,16,.12);
      font-weight:1000;
      font-size:12px;
      white-space:nowrap;
      user-select:none;
    }
    .pill b{font-size:13px}
    .pill .amt{
      padding:4px 8px;
      border-radius:999px;
      background: rgba(185,28,28,.10);
      border: 1px solid rgba(185,28,28,.18);
      color: #8a1212;
      font-weight:1000;
    }

    /* LAYOUT */
    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:14px;
      display:grid;
      gap:14px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1.55fr .95fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }

    /* BANNER */
    .banner{
      border-radius: 22px;
      overflow:hidden;
      border:1px solid rgba(59,42,31,.12);
      box-shadow: var(--shadow);
      background: #fff;
      position:relative;
    }
    .banner img{
      width:100%;
      height: 230px;
      object-fit: cover;
      display:block;
      filter: contrast(1.03) saturate(1.05);
    }
    @media (max-width:520px){
      .banner img{height:160px}
    }

    /* HERO */
    .hero{
      border-radius: 22px;
      overflow:hidden;
      border:1px solid rgba(59,42,31,.12);
      box-shadow: var(--shadow);
      background:
        linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.72));
      position:relative;
      padding:16px;
    }
    .hero::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(720px 260px at 18% 22%, rgba(185,28,28,.12), transparent 60%),
        radial-gradient(720px 260px at 82% 34%, rgba(201,138,30,.14), transparent 60%);
      pointer-events:none;
    }
    .heroTop{
      position:relative; z-index:2;
      display:flex; align-items:flex-end; justify-content:space-between; gap:14px;
      flex-wrap:wrap;
    }
    .hero h2{
      margin:0;
      font-size:26px;
      letter-spacing:-.6px;
      font-weight:1100;
    }
    .hero p{
      margin:8px 0 0;
      color: rgba(59,42,31,.75);
      font-weight:850;
      max-width: 760px;
      line-height:1.3;
    }
    .heroBadges{
      display:flex; flex-wrap:wrap; gap:10px; margin-top:12px;
    }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.75);
      border:1px solid rgba(59,42,31,.12);
      font-weight:1000;
      font-size:12px;
      color: rgba(59,42,31,.92);
      box-shadow: 0 12px 26px rgba(32,24,16,.10);
    }
    .chip strong{color:#7a0f0f}
    .heroNote{
      position:relative; z-index:2;
      margin-top:12px;
      font-size:12px;
      color: rgba(59,42,31,.74);
      font-weight:850;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(59,42,31,.12);
      background: rgba(255,255,255,.70);
    }

    /* CARD */
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.75));
      border:1px solid rgba(59,42,31,.12);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card h3{
      margin:0;
      padding:14px 14px 10px;
      font-size:14px;
      font-weight:1000;
      letter-spacing:.3px;
      border-bottom:1px solid rgba(59,42,31,.12);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background: rgba(255,255,255,.70);
    }
    .content{padding:14px}

    /* SEARCH + TABS */
    .searchRow{
      display:flex; gap:10px; align-items:center; margin-top:12px;
    }
    .searchRow input{
      flex:1;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(59,42,31,.14);
      background: rgba(255,255,255,.85);
      outline:none;
      font-size:14px;
      color: var(--ink);
    }
    .searchRow input::placeholder{color: rgba(59,42,31,.45)}

    .tabs{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin: 12px 0 10px;
    }
    .tab{
      border:1px solid rgba(59,42,31,.14);
      background: rgba(255,255,255,.75);
      padding:10px 14px;
      border-radius: 999px;
      font-weight:1000;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      letter-spacing:.3px;
      box-shadow: 0 12px 24px rgba(32,24,16,.10);
      position:relative;
      overflow:hidden;
    }
    .tab::after{
      content:"";
      position:absolute; inset:-2px;
      background: linear-gradient(90deg, rgba(185,28,28,.38), rgba(201,138,30,.30));
      opacity:0;
      transition: .2s ease;
      filter: blur(12px);
    }
    .tab:hover::after{opacity:.35}
    .tab span{position:relative; z-index:2}
    .tab.active{
      border-color: rgba(185,28,28,.28);
      background: rgba(255,255,255,.92);
      box-shadow: 0 0 0 3px rgba(185,28,28,.10), 0 18px 40px rgba(32,24,16,.12);
    }

    .sectionTitle{
      margin: 10px 0 10px;
      font-size: 34px;
      letter-spacing: .6px;
      font-weight: 1100;
      line-height:1;
      background: linear-gradient(90deg, #3b2a1f, rgba(59,42,31,.75));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }
    .divider{
      height: 4px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(185,28,28,.85), rgba(201,138,30,.75));
      opacity:.85;
      margin: 8px 0 18px;
    }

    /* PRODUCT GRID */
    .items{
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap:14px;
    }
    @media (max-width: 620px){
      .items{grid-template-columns:1fr}
      .sectionTitle{font-size:28px}
    }

    /* PRODUCT CARD */
    .prod{
      background: rgba(255,255,255,.78);
      border:1px solid rgba(59,42,31,.12);
      border-radius: 18px;
      overflow:hidden;
      display:grid;
      grid-template-columns: 1fr 1.1fr;
      min-height: 178px;
      box-shadow: 0 18px 46px rgba(32,24,16,.12);
      position:relative;
    }
    .prod::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(420px 180px at 18% 22%, rgba(185,28,28,.10), transparent 65%),
        radial-gradient(420px 180px at 82% 50%, rgba(201,138,30,.10), transparent 70%);
      pointer-events:none;
    }
    .prodLeft{
      padding:14px 14px 12px;
      display:flex;
      flex-direction:column;
      gap:8px;
      position:relative;
      z-index:2;
    }
    .prodName{
      font-weight:1100;
      font-size: 18px;
      margin:0;
      letter-spacing:.2px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      width:max-content;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:1100;
      border:1px solid rgba(59,42,31,.12);
      background: rgba(255,255,255,.85);
      color: rgba(59,42,31,.90);
    }
    .prodDesc{
      margin:0;
      color: rgba(59,42,31,.68);
      font-weight:850;
      line-height:1.25;
      font-size:13px;
    }
    .price{
      margin-top:auto;
      font-weight:1100;
      color: rgba(59,42,31,.78);
      font-size: 13px;
    }
    .price b{
      display:block;
      font-size: 18px;
      letter-spacing:.2px;
      color: var(--warn);
      text-shadow: 0 0 18px rgba(183,119,18,.10);
    }

    .prodRight{
      position:relative;
      z-index:2;
      padding:12px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      gap:10px;
    }
    .prodImg{
      width: 100%;
      height: 96px;
      border-radius: 16px;
      overflow:hidden;
      background: #fbf2e2;
      box-shadow: 0 14px 34px rgba(32,24,16,.14);
      border: 1px solid rgba(59,42,31,.12);
    }
    .prodImg img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }

    /* BOT√ìN AGREGAR */
    .btnAdd{
      border:none;
      cursor:pointer;
      padding: 10px 18px;
      border-radius: 999px;
      font-weight: 1100;
      color:#fff;
      background: linear-gradient(180deg, var(--brand), var(--brand2));
      box-shadow: 0 14px 30px rgba(185,28,28,.18), 0 0 0 2px rgba(185,28,28,.10);
      font-size: 15px;
      min-width: 150px;
    }
    .btnAdd:active{transform: translateY(1px)}
    .btnAdd:focus{outline: 3px solid rgba(201,138,30,.22)}

    /* CART */
    .cartLine{
      display:flex; justify-content:space-between; gap:10px; align-items:flex-start;
      border-bottom:1px dashed rgba(59,42,31,.18);
      padding:10px 0;
    }
    .cartLine:last-child{border-bottom:none}
    .muted{color: rgba(59,42,31,.62)}
    .qtyRow{display:flex; gap:6px; align-items:center}
    .mini{
      width:32px; height:32px;
      border-radius:12px;
      border:1px solid rgba(59,42,31,.14);
      background: rgba(255,255,255,.85);
      cursor:pointer;
      font-weight:1100;
      color: var(--ink);
    }
    .mini:active{transform: translateY(1px)}

    label{
      display:block; font-size:12px; font-weight:1100; margin:10px 0 6px;
      color: rgba(59,42,31,.86);
    }
    input, textarea, select{
      width:100%;
      padding:12px 12px;
      border:1px solid rgba(59,42,31,.14);
      border-radius:14px;
      font-size:14px;
      outline:none;
      background: rgba(255,255,255,.88);
      color: var(--ink);
    }
    textarea{min-height:90px; resize:vertical}
    input::placeholder, textarea::placeholder{color: rgba(59,42,31,.45)}

    .totalRow{
      display:flex; justify-content:space-between; align-items:center;
      padding-top:12px; margin-top:12px;
      border-top:1px solid rgba(59,42,31,.14);
      font-size:14px;
      font-weight:1100;
    }
    .totalRow strong{
      font-size:16px;
      color: #7a0f0f;
    }

    /* STICKY BAR */
    .stickyBar{
      position: sticky;
      bottom: 12px;
      z-index: 25;
      margin-top: 12px;
      border-radius: 16px;
      border:1px solid rgba(59,42,31,.14);
      background: rgba(251,242,226,.92);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 50px rgba(32,24,16,.16);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px 10px 10px 12px;
    }
    .stickyBar .left{
      display:flex; align-items:center; gap:10px;
      font-weight:1100;
    }
    .stickyBar .amount{
      font-size:16px;
      letter-spacing:.2px;
      color: var(--warn);
      text-shadow: 0 0 18px rgba(183,119,18,.10);
    }
    .stickyBtn{
      border:none;
      cursor:pointer;
      padding: 12px 16px;
      border-radius: 14px;
      font-weight: 1100;
      color:#fff;
      background: linear-gradient(180deg, var(--brand), var(--brand2));
      box-shadow: 0 14px 30px rgba(185,28,28,.18);
      min-width: 180px;
    }
    .btnGhost{
      border:1px solid rgba(59,42,31,.14);
      background: rgba(255,255,255,.85);
      color: var(--ink);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 1100;
      cursor:pointer;
    }

    /* MODALS */
    .backdrop{
      position:fixed; inset:0;
      background:rgba(0,0,0,.58);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:60;
    }
    .modal{
      width:min(820px, 100%);
      background: rgba(251,242,226,.96);
      backdrop-filter: blur(10px);
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(59,42,31,.14);
      box-shadow: 0 40px 120px rgba(0,0,0,.35);
      color: var(--ink);
    }
    .modalHead{
      padding:14px 16px;
      border-bottom:1px solid rgba(59,42,31,.14);
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      background: rgba(255,255,255,.70);
    }
    .modalHead h3{margin:0; font-size:15px}
    .closeX{
      border:1px solid rgba(59,42,31,.14);
      background: rgba(255,255,255,.80);
      border-radius:12px;
      width:40px; height:40px;
      cursor:pointer;
      font-weight:1100;
      color: var(--ink);
    }
    .optGroup{
      border:1px solid rgba(59,42,31,.14);
      border-radius:16px;
      padding:12px 12px;
      margin-top:10px;
      background: rgba(255,255,255,.70);
    }
    .optTitle{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .optTitle b{font-size:13px}
    .optTitle span{font-size:12px; color:rgba(59,42,31,.60); font-weight:900}
    .optList{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
    .opt{
      border:1px solid rgba(59,42,31,.14);
      background: rgba(255,255,255,.85);
      padding:8px 10px;
      border-radius:999px;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      font-weight:1100;
      color: var(--ink);
    }
    .opt.active{
      border-color: rgba(185,28,28,.50);
      box-shadow:0 0 0 3px rgba(185,28,28,.14);
    }
    .footerBtns{
      display:flex;
      gap:10px;
      padding:14px 16px;
      border-top:1px solid rgba(59,42,31,.14);
      background: rgba(255,255,255,.70);
    }
    .footerBtns button{flex:1}

    .stepsBackdrop{
      position:fixed; inset:0;
      background:rgba(0,0,0,.58);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:70;
    }
    .steps{
      width:min(760px, 100%);
      background: rgba(251,242,226,.96);
      backdrop-filter: blur(10px);
      border-radius: 18px;
      overflow:hidden;
      border:1px solid rgba(59,42,31,.14);
      box-shadow: 0 40px 120px rgba(0,0,0,.35);
      color: var(--ink);
    }
    .stepsHead{
      padding:14px 16px;
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      border-bottom:1px solid rgba(59,42,31,.14);
      background: rgba(255,255,255,.70);
    }
    .stepsHead .t{display:flex; flex-direction:column; gap:4px;}
    .stepsHead .t b{font-size:16px}
    .stepsHead .t span{font-size:12px; color:rgba(59,42,31,.60); font-weight:900}
    .stepsBody{padding:14px 16px}
    .stepRow{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width:520px){ .stepRow{grid-template-columns:1fr} }
    .stepsFoot{
      display:flex; gap:10px;
      padding:14px 16px;
      border-top:1px solid rgba(59,42,31,.14);
      background: rgba(255,255,255,.70);
    }

    .btnDark{
      border:none;
      cursor:pointer;
      padding:12px 14px;
      border-radius: 14px;
      font-weight:1100;
      color:#fff;
      background: linear-gradient(180deg, var(--brand), var(--brand2));
      box-shadow: 0 14px 32px rgba(185,28,28,.18);
    }
    .btnLight{
      border:1px solid rgba(59,42,31,.14);
      background: rgba(255,255,255,.85);
      color: var(--ink);
      padding:12px 14px;
      border-radius: 14px;
      font-weight:1100;
      cursor:pointer;
    }

    .note{
      font-size:12px;
      color: rgba(59,42,31,.62);
      font-weight:900;
      line-height:1.35;
      background: rgba(255,255,255,.70);
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(59,42,31,.14);
      margin-top:12px;
    }
    .tiny{
      font-size:12px;
      color: rgba(59,42,31,.70);
      font-weight:900;
      line-height:1.35;
    }
    .hint{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:14px;
      border:1px solid rgba(59,42,31,.14);
      background: rgba(255,255,255,.80);
      font-weight:950;
      font-size:12px;
      color: rgba(59,42,31,.90);
    }
  </style>
</head>

<body>
<header>
  <div class="row">
    <div class="brand">
      <h1>ü•© Mayoreo ‚Äî Carnicer√≠a (Cliente arma su pedido)</h1>
      <div class="sub">Selecci√≥n por piezas/kg/cajas ‚Ä¢ checkout por pasos ‚Ä¢ WhatsApp</div>
    </div>
    <div class="pill" id="cartPill">üõí <b>0</b> <span class="amt" id="pillTotal">Cotizaci√≥n</span></div>
  </div>
</header>

<div class="wrap">

  <!-- BANNER -->
  <div class="banner">
    <img src="menuu.jpeg" alt="Banner Mayoreo">
  </div>

  <div class="hero">
    <div class="heroTop">
      <div>
        <h2>Haz tu pedido de mayoreo en 1 minuto.</h2>
        <p>Selecciona productos (piezas/kg/cajas), agrega instrucciones como ‚Äúcabeza en 4‚Äù, ‚Äúpata en rodajas‚Äù y env√≠a por WhatsApp para cotizar y confirmar.</p>
        <div class="heroBadges">
          <div class="chip">üì¶ <strong>Mayoreo</strong> (pza / kg / caja)</div>
          <div class="chip">üßæ Pedido por pasos</div>
          <div class="chip">‚ö° Respuesta r√°pida</div>
        </div>
      </div>
      <div class="hint" title="Precios no visibles en el link">üí¨ Precios: <span style="color:#b77712">a cotizar</span></div>
    </div>
    <div class="heroNote">
      Tip: En <b>Notas generales</b> escribe cortes/instrucciones. Ej: <b>‚ÄúCabeza en 4, pata en rodajas, entregar 9:30am‚Äù</b>.
    </div>
  </div>

  <div class="grid">

    <!-- CAT√ÅLOGO -->
    <section class="card">
      <h3>Cat√°logo <span class="muted" style="font-size:12px;font-weight:900">elige y agrega</span></h3>
      <div class="content">

        <div class="searchRow">
          <input id="q" placeholder="Buscar (ej. cabeza, pata, caja, tripa, coraz√≥n)..."/>
        </div>

        <div class="tabs" id="tabs"></div>

        <div id="sectionHdr">
          <div class="sectionTitle" id="sectionTitle">V√çSCERAS</div>
          <div class="divider"></div>
        </div>

        <div class="items" id="items"></div>

        <div class="note">
          Este link es para tu cliente: √©l arma el pedido y al final se abre WhatsApp con el mensaje listo para cotizaci√≥n.
        </div>

      </div>
    </section>

    <!-- CARRITO -->
    <aside class="card">
      <h3>Tu pedido</h3>
      <div class="content">

        <label>Canal</label>
        <select id="canal">
          <option value="recoger">Pasar a recoger</option>
          <option value="domicilio">Env√≠o / Ruta</option>
        </select>

        <div id="cart"></div>

        <div class="totalRow">
          <span>Total</span>
          <strong id="total">Cotizaci√≥n</strong>
        </div>

        <div class="note">
          Al dar <b>CONTINUAR</b> te sale el checkout por pasos y al final abre WhatsApp con el pedido listo.
        </div>

        <div class="stickyBar">
          <div class="left">
            <span style="opacity:.9">üßæ</span>
            <span class="amount" id="barTotal">Cotizaci√≥n</span>
          </div>
          <div style="display:flex; gap:8px; align-items:center">
            <button class="btnGhost" id="btnClear">Vaciar</button>
            <button class="stickyBtn" id="btnCheckout">CONTINUAR</button>
          </div>
        </div>

      </div>
    </aside>

  </div>
</div>

<!-- MODAL MODIFICADORES -->
<div class="backdrop" id="backdrop">
  <div class="modal">
    <div class="modalHead">
      <div>
        <h3 id="mTitle">Producto</h3>
        <div class="muted" style="font-size:12px;font-weight:900">Configura unidad / presentaci√≥n / nota</div>
      </div>
      <button class="closeX" id="mClose">‚úï</button>
    </div>

    <div class="content" id="mBody"></div>

    <div class="footerBtns">
      <button class="btnLight" id="mCancel">Cancelar</button>
      <button class="btnDark" id="mAdd">Agregar al pedido</button>
    </div>
  </div>
</div>

<!-- CHECKOUT POR PASOS -->
<div class="stepsBackdrop" id="stepsBackdrop">
  <div class="steps">
    <div class="stepsHead">
      <div class="t">
        <b id="stepTitle">Paso 1 de 3</b>
        <span id="stepSub">Datos del cliente</span>
      </div>
      <button class="closeX" id="stepsClose">‚úï</button>
    </div>

    <div class="stepsBody" id="stepsBody"></div>

    <div class="stepsFoot">
      <button class="btnLight" id="btnBack">Regresar</button>
      <button class="btnDark" id="btnNext">Continuar</button>
    </div>
  </div>
</div>

<script>
/** =========================
 *  CONFIG
 *  ========================= */
const NEGOCIO_NOMBRE = "Carnicer√≠a Mayoreo";
const WHATSAPP_TAQ = "524621872594"; // 52 + n√∫mero sin + (c√°mbialo si quieres)
const IMG_BASE = ""; // si est√°n en /assets -> "assets/"

/** =========================
 *  CAT√ÅLOGO
 *  - units: unidades permitidas en el modal (pza/kg/caja)
 *  ========================= */
const catalogo = [
  // V√çSCERAS (pza o kg)
  {id:"cabezaderes",  cat:"V√çSCERAS", name:"Cabeza de res",    units:["pza","kg"], desc:"Se puede partir / con lengua seg√∫n nota.", mods:true, img:"cabezaderes.png"},
  {id:"patablanca",   cat:"V√çSCERAS", name:"Pata blanca",      units:["pza","kg"], desc:"Corte/rodajas bajo indicaci√≥n.", mods:true, img:"patablanca.jpeg"},
  {id:"patamorena",   cat:"V√çSCERAS", name:"Pata morena",      units:["pza","kg"], desc:"Ideal para caldos.", mods:true, img:"patamorena.png"},
  {id:"panzaderes",   cat:"V√çSCERAS", name:"Panza de res",     units:["pza","kg"], desc:"Especifica si la quieres sucia/limpia en la nota.", mods:true, img:"panzaderes.png"},
  {id:"libroderes",   cat:"V√çSCERAS", name:"Libro de res",     units:["pza","kg"], desc:"Venta por pieza o kilo.", mods:true, img:"libroderes.png"},
  {id:"tripaderes",   cat:"V√çSCERAS", name:"Tripa de res",     units:["pza","kg"], desc:"Venta por pieza o kilo.", mods:true, img:"tripaderes.png"},
  {id:"tripaderastro",cat:"V√çSCERAS", name:"Tripa de rastro",  units:["pza","kg"], desc:"Venta por pieza o kilo.", mods:true, img:"tripaderastro.png"},
  {id:"teleco",       cat:"V√çSCERAS", name:"Teleco",           units:["pza","kg"], desc:"Venta por pieza o kilo.", mods:true, img:"teleco.png"},
  {id:"cuajo",        cat:"V√çSCERAS", name:"Cuajo",            units:["pza","kg"], desc:"Venta por pieza o kilo.", mods:true, img:"cuajo.png"},
  {id:"corazon",      cat:"V√çSCERAS", name:"Coraz√≥n",          units:["pza","kg"], desc:"Venta por pieza o kilo.", mods:true, img:"corazon.png"},
  {id:"higado",       cat:"V√çSCERAS", name:"H√≠gado",           units:["pza","kg"], desc:"Venta por pieza o kilo.", mods:true, img:"higado.png"},
  {id:"bofe",         cat:"V√çSCERAS", name:"Bofe",             units:["pza","kg"], desc:"Venta por pieza o kilo.", mods:true, img:"bofe.jpg"},

  // CAJAS (solo caja)
  {id:"cajaazul",     cat:"CAJAS", name:"Caja azul",       units:["caja"], desc:"Venta por caja. Especifica marca/peso si aplica.", mods:true, img:"cajaazul.jpeg"},
  {id:"cajawas",      cat:"CAJAS", name:"Caja Washington", units:["caja"], desc:"Venta por caja. Especifica cantidad de cajas.", mods:true, img:"cajawas.jpeg"},
  {id:"canadian",     cat:"CAJAS", name:"Menudo Canadian", units:["caja"], desc:"Venta por caja. Especifica cantidad.", mods:true, img:"canadian.jpg"},
];

const CATS = ["V√çSCERAS","CAJAS"];

/** =========================
 *  MODIFICADORES (solo PRESENTACI√ìN)
 *  ========================= */
const MODS = {
  presentacion: { title:"Presentaci√≥n", type:"single", required:false,
    options:["Completo","Partido en 2","Partido en 4","En rodajas","Sin especificar"]
  }
};

function modsPara(item){
  if(!item.mods) return [];
  return ["presentacion"];
}

/** =========================
 *  HELPERS
 *  ========================= */
function escapeHtml(s){
  return (s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
}
function modsToText(mods){
  const parts = [];
  for(const k of Object.keys(mods||{})){
    const val = mods[k];
    if(typeof val==="string" && val && val!=="Sin especificar") parts.push(`${MODS[k].title}: ${val}`);
  }
  return parts.join(" ‚Ä¢ ");
}
function buildKey(item, unitSel, mods, note){
  return item.id + "|" + unitSel + "|" + JSON.stringify(mods) + "|" + (note||"");
}
function validateRequired(item, mods){
  const keys = modsPara(item);
  for(const k of keys){
    const g = MODS[k];
    if(!g || !g.required) continue;
    const v = mods[k];
    if(g.type==="single" && !v) return `${g.title} es obligatorio.`;
  }
  return null;
}

/** =========================
 *  UI MEN√ö
 *  ========================= */
const tabs = document.getElementById("tabs");
const itemsBox = document.getElementById("items");
const sectionTitle = document.getElementById("sectionTitle");
const q = document.getElementById("q");

let activeCat = CATS[0];

function renderTabs(){
  tabs.innerHTML = "";
  CATS.forEach(c=>{
    const el = document.createElement("div");
    el.className = "tab" + (c===activeCat ? " active":"");
    el.innerHTML = `<span>${c}</span>`;
    el.onclick = ()=>{ activeCat=c; renderTabs(); renderItems(); };
    tabs.appendChild(el);
  });
}

function unitsLabel(it){
  return (it.units || []).join(" / ");
}

function renderItems(){
  sectionTitle.textContent = activeCat;

  const term = (q.value||"").trim().toLowerCase();
  const list = catalogo.filter(x=>{
    const inCat = x.cat===activeCat;
    const inSearch = !term || (x.name.toLowerCase().includes(term) || (x.desc||"").toLowerCase().includes(term) || x.id.toLowerCase().includes(term));
    return inCat && inSearch;
  });

  itemsBox.innerHTML = "";
  list.forEach(it=>{
    const card = document.createElement("div");
    card.className = "prod";
    const badge = it.cat==="CAJAS" ? "üì¶ Caja" : "ü•© Mayoreo";
    card.innerHTML = `
      <div class="prodLeft">
        <div class="badge">${badge} ‚Ä¢ ${escapeHtml(unitsLabel(it))}</div>
        <h3 class="prodName">${escapeHtml(it.name)}</h3>
        <p class="prodDesc">${escapeHtml(it.desc || "")}</p>
        <div class="price">Precio <b>A cotizar</b></div>
      </div>
      <div class="prodRight">
        <div class="prodImg">
          <img src="${IMG_BASE + it.img}" alt="${escapeHtml(it.name)}">
        </div>
        <button class="btnAdd" data-id="${it.id}">Agregar</button>
      </div>
    `;
    card.querySelector("button").onclick = ()=> onAddClicked(it);
    itemsBox.appendChild(card);
  });

  if(list.length===0){
    itemsBox.innerHTML = `<div class="muted" style="font-weight:1100">No hay resultados.</div>`;
  }
}
q.addEventListener("input", renderItems);

/** =========================
 *  CARRITO (sin precios: solo qty)
 *  ========================= */
let cart = []; // {key, id, name, unitSel, qty, mods, note}

const cartBox = document.getElementById("cart");
const totalEl = document.getElementById("total");
const cartPill = document.getElementById("cartPill");
const barTotal = document.getElementById("barTotal");

function cartCount(){ return cart.reduce((a,x)=>a + x.qty, 0); }

function renderCart(){
  const count = cartCount();
  cartPill.innerHTML = `üõí <b>${count}</b> <span class="amt">Cotizaci√≥n</span>`;
  totalEl.textContent = "Cotizaci√≥n";
  barTotal.textContent = "Cotizaci√≥n";

  if(cart.length===0){
    cartBox.innerHTML = `<div class="muted" style="font-weight:1100">A√∫n no agregas nada üòÑ</div>`;
    return;
  }
  cartBox.innerHTML = "";
  cart.forEach((line, idx)=>{
    const wrap = document.createElement("div");
    wrap.className = "cartLine";
    wrap.innerHTML = `
      <div style="min-width:0">
        <div style="font-weight:1100;font-size:14px">${escapeHtml(line.name)}
          <span class="muted" style="font-weight:1100">(${escapeHtml(line.unitSel)})</span>
        </div>
        <div class="muted" style="font-size:12px; margin-top:4px; line-height:1.25; font-weight:900">
          ${escapeHtml(modsToText(line.mods) || "")}
        </div>
        ${line.note ? `<div class="muted" style="font-size:12px; margin-top:4px; font-weight:900">Nota: ${escapeHtml(line.note)}</div>` : ``}
      </div>
      <div style="text-align:right">
        <div class="qtyRow">
          <button class="mini" data-act="dec">‚àí</button>
          <div style="min-width:28px; text-align:center; font-weight:1100">${line.qty}</div>
          <button class="mini" data-act="inc">+</button>
        </div>
        <button class="mini" style="margin-top:8px;width:100%;height:34px;border-radius:12px;font-weight:1100">‚úï</button>
      </div>
    `;
    wrap.querySelector('[data-act="dec"]').onclick = ()=>{ line.qty=Math.max(1,line.qty-1); renderCart(); };
    wrap.querySelector('[data-act="inc"]').onclick = ()=>{ line.qty+=1; renderCart(); };
    wrap.querySelector('.mini:last-child').onclick = ()=>{ cart.splice(idx,1); renderCart(); };
    cartBox.appendChild(wrap);
  });
}

/** =========================
 *  MODAL MODS (unidad + presentacion + nota)
 *  ========================= */
const backdrop = document.getElementById("backdrop");
const mTitle = document.getElementById("mTitle");
const mBody  = document.getElementById("mBody");
const mClose = document.getElementById("mClose");
const mCancel= document.getElementById("mCancel");
const mAdd   = document.getElementById("mAdd");

let currentItem = null;
let draft = null;

function openModal(item){
  currentItem = item;
  draft = {unitSel:(item.units?.[0] || "pza"), mods:{}, note:""};
  mTitle.textContent = `${item.name}`;
  mBody.innerHTML = "";

  // UNIDAD (pza/kg/caja)
  const u = document.createElement("div");
  u.className = "optGroup";
  u.innerHTML = `
    <div class="optTitle">
      <b>Unidad</b>
      <span>elige 1</span>
    </div>
    <div class="optList" data-k="__unit"></div>
  `;
  const ul = u.querySelector(".optList");
  (item.units || ["pza"]).forEach(opt=>{
    const o = document.createElement("div");
    o.className = "opt" + (opt===draft.unitSel ? " active":"");
    o.textContent = opt;
    o.onclick = ()=>{
      draft.unitSel = opt;
      ul.querySelectorAll(".opt").forEach(x=>x.classList.remove("active"));
      o.classList.add("active");
    };
    ul.appendChild(o);
  });
  mBody.appendChild(u);

  // PRESENTACI√ìN
  const keys = modsPara(item);
  keys.forEach(k=>{
    const g = MODS[k];
    if(!g) return;

    const box = document.createElement("div");
    box.className = "optGroup";
    box.innerHTML = `
      <div class="optTitle">
        <b>${g.title}${g.required ? " *":""}</b>
        <span>elige 1</span>
      </div>
      <div class="optList" data-k="${k}"></div>
    `;
    const list = box.querySelector(".optList");
    g.options.forEach(opt=>{
      const o = document.createElement("div");
      o.className = "opt";
      o.textContent = opt;
      o.onclick = ()=>{
        draft.mods[k] = opt;
        list.querySelectorAll(".opt").forEach(x=>x.classList.remove("active"));
        o.classList.add("active");
      };
      list.appendChild(o);
    });
    mBody.appendChild(box);
  });

  // NOTA
  const n = document.createElement("div");
  n.className = "optGroup";
  n.innerHTML = `
    <div class="optTitle">
      <b>Nota del producto (opcional)</b>
      <span>ej. ‚Äúcon lengua‚Äù, ‚Äúsin grasa‚Äù, ‚Äúpara hoy‚Äù, etc.</span>
    </div>
    <div style="margin-top:10px">
      <input id="noteProd" placeholder="Escribe una nota para este producto..."/>
    </div>
  `;
  mBody.appendChild(n);

  backdrop.style.display = "flex";
  setTimeout(()=> {
    const inp = document.getElementById("noteProd");
    if(inp) inp.oninput = ()=> draft.note = inp.value;
  }, 0);
}

function closeModal(){
  backdrop.style.display = "none";
  currentItem = null;
  draft = null;
}

function addLine(item, unitSel, mods, note){
  const key = buildKey(item, unitSel, mods, note);
  const existing = cart.find(x=>x.key===key);
  if(existing){ existing.qty += 1; }
  else{
    cart.push({
      key,
      id:item.id,
      name:item.name,
      unitSel: unitSel,
      qty:1,
      mods: mods,
      note: note || ""
    });
  }
  renderCart();
}

function onAddClicked(item){
  openModal(item);
}

mClose.onclick = closeModal;
mCancel.onclick = closeModal;
backdrop.addEventListener("click", (e)=>{ if(e.target===backdrop) closeModal(); });

mAdd.onclick = ()=>{
  if(!currentItem || !draft) return;
  const err = validateRequired(currentItem, draft.mods);
  if(err){ alert(err); return; }
  addLine(currentItem, draft.unitSel, draft.mods, draft.note);
  closeModal();
};

/** =========================
 *  CHECKOUT POR PASOS (id√©ntico a tu flujo)
 *  ========================= */
const canalEl = document.getElementById("canal");

const stepsBackdrop = document.getElementById("stepsBackdrop");
const stepsClose = document.getElementById("stepsClose");
const stepsBody = document.getElementById("stepsBody");
const stepTitle = document.getElementById("stepTitle");
const stepSub = document.getElementById("stepSub");
const btnBack = document.getElementById("btnBack");
const btnNext = document.getElementById("btnNext");

let step = 1;

// Guardado simple de clientes
const LS_CLIENTES_KEY = "mayoreo_clientes_hist";

function getClientesHist(){
  try{ return JSON.parse(localStorage.getItem(LS_CLIENTES_KEY) || "[]"); }
  catch(e){ return []; }
}
function addClienteHist(nombre){
  const n = (nombre||"").trim();
  if(!n) return;
  const list = getClientesHist();
  const exists = list.some(x=>x.toLowerCase()===n.toLowerCase());
  const next = exists ? list : [n, ...list].slice(0, 15);
  localStorage.setItem(LS_CLIENTES_KEY, JSON.stringify(next));
}

const form = {
  cliente: "",
  tel: "",
  canal: "recoger",
  direccion: "",
  fecha: "",
  horario: "",
  notas: ""
};

function openSteps(){
  step = 1;
  stepsBackdrop.style.display = "flex";
  renderStep();
}
function closeSteps(){ stepsBackdrop.style.display = "none"; }

function renderStep(){
  const canal = canalEl.value;

  if(step===1){
    stepTitle.textContent = "Paso 1 de 3";
    stepSub.textContent = "Datos del cliente";
  } else if(step===2){
    stepTitle.textContent = "Paso 2 de 3";
    stepSub.textContent = (canal==="domicilio") ? "Entrega / Ruta" : "Recoger";
  } else {
    stepTitle.textContent = "Paso 3 de 3";
    stepSub.textContent = "Confirmar y enviar";
  }

  btnBack.style.display = (step===1) ? "none" : "inline-block";
  btnNext.textContent = (step===3) ? "ENVIAR WHATSAPP" : "CONTINUAR";

  if(step===1){
    const options = getClientesHist().map(n=>`<option value="${escapeHtml(n)}"></option>`).join("");
    stepsBody.innerHTML = `
      <label>* Cliente / Negocio</label>
      <input id="s_cliente" list="clientesList" value="${escapeHtml(form.cliente)}" placeholder="Ej. Taquer√≠a / Menuder√≠a / Distribuidor">
      <datalist id="clientesList">${options}</datalist>

      <label>* Tel√©fono</label>
      <input id="s_tel" value="${escapeHtml(form.tel)}" placeholder="Ej. 4621234567">

      <div class="note">
        Tu pedido se enviar√° para <b>cotizaci√≥n</b>. Agrega productos y contin√∫a.
      </div>
    `;
    setTimeout(()=>{
      document.getElementById("s_cliente").oninput = e=> form.cliente = e.target.value;
      document.getElementById("s_tel").oninput = e=> form.tel = e.target.value;
    },0);
    return;
  }

  if(step===2){
    if(canal!=="domicilio"){
      stepsBody.innerHTML = `
        <div class="note">
          Canal seleccionado: <b>Pasar a recoger</b>. Si quieres entrega/ruta cambia el canal antes de continuar.
        </div>

        <label>Fecha deseada (opcional)</label>
        <input id="s_fecha" value="${escapeHtml(form.fecha)}" placeholder="Ej. Hoy / Ma√±ana / 18-Feb">

        <label>Horario (opcional)</label>
        <input id="s_horario" value="${escapeHtml(form.horario)}" placeholder="Ej. 9:30am / 2pm">

        <label>Notas generales (opcional)</label>
        <textarea id="s_notas" placeholder="Ej. 'Cabeza en 4', 'Pata en rodajas', 'Entrega 9:30am'">${escapeHtml(form.notas)}</textarea>
      `;
      setTimeout(()=>{
        document.getElementById("s_fecha").oninput   = e=> form.fecha = e.target.value;
        document.getElementById("s_horario").oninput = e=> form.horario = e.target.value;
        document.getElementById("s_notas").oninput   = e=> form.notas = e.target.value;
      },0);
      return;
    }

    stepsBody.innerHTML = `
      <label>* Direcci√≥n (entrega / ruta)</label>
      <textarea id="s_dir" placeholder="Calle, n√∫mero, colonia, referencias...">${escapeHtml(form.direccion)}</textarea>

      <label>Fecha deseada (opcional)</label>
      <input id="s_fecha" value="${escapeHtml(form.fecha)}" placeholder="Ej. Hoy / Ma√±ana / 18-Feb">

      <label>Horario (opcional)</label>
      <input id="s_horario" value="${escapeHtml(form.horario)}" placeholder="Ej. 9:30am / 2pm">

      <label>Notas generales (opcional)</label>
      <textarea id="s_notas" placeholder="Ej. 'Cabeza en 4', 'Pata en rodajas', 'Entrega 9:30am'">${escapeHtml(form.notas)}</textarea>

      <div class="note">
        Si tu direcci√≥n es grande, agrega referencias (port√≥n, color, entre calles).
      </div>
    `;
    setTimeout(()=>{
      document.getElementById("s_dir").oninput      = e=> form.direccion = e.target.value;
      document.getElementById("s_fecha").oninput   = e=> form.fecha = e.target.value;
      document.getElementById("s_horario").oninput = e=> form.horario = e.target.value;
      document.getElementById("s_notas").oninput   = e=> form.notas = e.target.value;
    },0);
    return;
  }

  const canalTxt = canal==="domicilio" ? "Env√≠o / Ruta" : "Pasar a recoger";
  stepsBody.innerHTML = `
    <div class="note">
      <b>Cliente:</b> ${escapeHtml(form.cliente || "-")}<br>
      <b>Tel:</b> +52${escapeHtml((form.tel||"").replace(/\D/g,""))}<br>
      <b>Canal:</b> ${escapeHtml(canalTxt)}<br>
      ${canal==="domicilio" ? `<b>Direcci√≥n:</b> ${escapeHtml(form.direccion || "-")}<br>` : ``}
      ${form.fecha ? `<b>Fecha:</b> ${escapeHtml(form.fecha)}<br>` : ``}
      ${form.horario ? `<b>Horario:</b> ${escapeHtml(form.horario)}<br>` : ``}
    </div>
    <div class="tiny">
      Al enviar, se abrir√° WhatsApp con el pedido listo para <b>cotizaci√≥n</b> y confirmaci√≥n.
    </div>
  `;
}

function stepValidate(){
  const canal = canalEl.value;
  if(step===1){
    if(!form.cliente.trim()) return "Pon el Cliente / Negocio.";
    if(!form.tel.trim()) return "Pon el tel√©fono.";
  }
  if(step===2 && canal==="domicilio"){
    if(!form.direccion.trim()) return "Falta la direcci√≥n.";
  }
  return null;
}

function cleanWA(text){
  return (text || "")
    .replace(/\uFFFD/g, "")
    .replace(/\r\n/g, "\n")
    .replace(/\n{3,}/g, "\n\n")
    .trim();
}

function buildWhatsAppText(){
  const canal = canalEl.value;
  const canalTxt = canal==="domicilio" ? "Env√≠o / Ruta" : "Pasar a recoger";
  const orderNo = String(Date.now()).slice(-6);

  const lines = [];
  lines.push(`*${NEGOCIO_NOMBRE}*`);
  lines.push(`Hola, soy *${form.cliente}*. Quiero *cotizar* el siguiente pedido de mayoreo:`);
  lines.push(``);
  lines.push(`Folio: *MAY-${orderNo}*`);
  lines.push(`Canal: *${canalTxt}*`);
  lines.push(`Contacto: *+52${form.tel.replace(/\D/g,"")}*`);

  if(canal==="domicilio"){
    lines.push(``);
    lines.push(`Direcci√≥n:`);
    lines.push(form.direccion);
  }

  if(form.fecha || form.horario){
    lines.push(``);
    if(form.fecha)   lines.push(`Fecha deseada: *${form.fecha}*`);
    if(form.horario) lines.push(`Horario: *${form.horario}*`);
  }

  lines.push(``);
  lines.push(`--------------------------`);
  cart.forEach(x=>{
    lines.push(`- ${x.qty} ${x.unitSel} x ${x.name}`);
    const mt = modsToText(x.mods);
    if(mt) lines.push(`  ‚Ä¢ ${mt}`);
    if(x.note) lines.push(`  ‚Ä¢ Nota: ${x.note}`);
  });
  lines.push(`--------------------------`);
  lines.push(`Total: *A cotizar*`);

  if(form.notas.trim()){
    lines.push(``);
    lines.push(`Notas generales: ${form.notas}`);
  }

  lines.push(``);
  lines.push(`Gracias. Quedo atento a la cotizaci√≥n üôå`);
  return lines.join("\n");
}

/** Botones checkout */
document.getElementById("btnCheckout").onclick = ()=>{
  if(cart.length===0){ alert("Agrega algo al pedido primero üòÑ"); return; }
  openSteps();
};

btnBack.onclick = ()=>{ if(step>1){ step--; renderStep(); } };

btnNext.onclick = ()=>{
  const err = stepValidate();
  if(err){ alert(err); return; }

  const canal = canalEl.value;
  form.canal = canal;

  if(step===1){ step=2; renderStep(); return; }
  if(step===2){ step=3; renderStep(); return; }

  addClienteHist(form.cliente);

  const text = cleanWA(buildWhatsAppText());
  const url = `https://wa.me/${WHATSAPP_TAQ}?text=${encodeURIComponent(text)}`;
  window.open(url, "_blank");
  closeSteps();
};

stepsClose.onclick = closeSteps;
stepsBackdrop.addEventListener("click", (e)=>{ if(e.target===stepsBackdrop) closeSteps(); });

document.getElementById("btnClear").onclick = ()=>{
  if(confirm("¬øVaciar pedido?")){
    cart = [];
    renderCart();
  }
};

/** INIT */
renderTabs();
renderItems();
renderCart();
</script>

</body>
</html>
